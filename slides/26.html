<div>
    <h1>Temporizador</h1>

    <ul>
        <li class="slide-step-1">Controla operações de tempo</li>
        <li class="slide-step-2"><code>Delay</code> é um <code>Future</code> que termina em um determinado instante</li>
        <li class="slide-step-3"><code>Interval</code> é um <code>Stream</code> que produz um ítem por vez a um intervalo de tempo
        determinado</li>
    </ul>

    <svg style="width: 20%" viewBox="-100 0 1000 100">
        <defs>
            <g id="arrow-head">
                <path d="M-20 -20 L0 0 L-20 20"/>
            </g>
            <g id="small-arrow-head">
                <path d="M-10 -10 L0 0 L-10 10"/>
            </g>
            <g id="mini-arrow-head">
                <path d="M-8 -8 L0 0 L-8 8"/>
            </g>
            <g id="thread">
                <path d="M0 0 q 10 10 -10 20 t 0 20 0 20 0 20 0 20 0 20 0 20"/>
            </g>
            <g id="future">
                <circle cx="0" cy="0" r="10"/>
            </g>
            <g id="stream">
                <circle cx="0" cy="0" r="10"/>
                <g style="stroke: none; fill: black">
                    <circle cx="9" cy="10" r="2"/>
                    <circle cx="15" cy="10" r="2"/>
                    <circle cx="21" cy="10" r="2"/>
                </g>
            </g>
            <g id="nothing">
                <path d="M-5 -10 A 15 15 30 0 0 -5 10"/>
                <path d="M5 -10 A 15 15 30 0 1 5 10"/>
            </g>
            <g id="item">
                <circle cx="0" cy="-10" r="3" style="fill: brown; stroke: none"/>
                <line x1="0" y1="10" x2="0" y2="-5" style="stroke: brown; stroke-width: 5"/>
            </g>
            <g id="fail">
                <g style="stroke: red; stroke-width: 5">
                    <path d="M-10 -10 L 10 10"/>
                    <path d="M10 -10 L -10 10"/>
                </g>
            </g>
            <g id="task">
                <rect x="-25" y="-25" width="50" height="50"/>
            </g>
            <g id="token">
                <circle cx="0" cy="0" r="5"/>
            </g>
			<g id="event-loop">
				<circle cx="0" cy="0" r="30"/>
				<g style="stroke: none; fill: white">
					<circle cx="26" cy="15" r="5"/>
				</g>
				<g style="stroke: none; fill: white">
					<circle cx="-26" cy="15" r="5"/>
				</g>
				<g style="stroke: none; fill: white">
					<circle cx="0" cy="-30" r="5"/>
				</g>
				<g transform="translate(-5,-30)">
					<path d="M-10 -10 L0 0 l-10 10" transform="rotate(-25)"/>
				</g>
				<g transform="rotate(120),translate(-5,-30)">
					<path d="M-10 -10 L0 0 l-10 10" transform="rotate(-25)"/>
				</g>
				<g transform="rotate(240),translate(-5,-30)">
					<path d="M-10 -10 L0 0 l-10 10" transform="rotate(-25)"/>
				</g>
			</g>
            <g id="executor">
                <rect x="-45" y="-45" width="90" height="90" rx="20" ry="20"/>
            </g>
			<g id="timer">
				<circle cx="0" cy="0" r="15"/>
				<line x1="0" y1="0" x2="0" y2="-12"/>
			</g>
			<g id="clock">
				<circle cx="0" cy="0" r="25"/>
				<line x1="0" y1="0" x2="0" y2="-20"/>
				<line x1="0" y1="0" x2="10" y2="-10"/>
			</g>
            <g id="cpu">
                <g style="fill: none; stroke: black; stroke-width: 3">
                    <rect x="-12.5" y="-12.5" width="25" height="25"/>

                    <line x1="-16" y1="0" x2="-20" y2="0"/>
                    <line x1="-16" y1="-12.5" x2="-20" y2="-12.5"/>
                    <line x1="-16" y1="-6.25" x2="-20" y2="-6.25"/>
                    <line x1="-16" y1="12.5" x2="-20" y2="12.5"/>
                    <line x1="-16" y1="6.25" x2="-20" y2="6.25"/>

                    <line x1="16" y1="0" x2="20" y2="0"/>
                    <line x1="16" y1="-12.5" x2="20" y2="-12.5"/>
                    <line x1="16" y1="-6.25" x2="20" y2="-6.25"/>
                    <line x1="16" y1="12.5" x2="20" y2="12.5"/>
                    <line x1="16" y1="6.25" x2="20" y2="6.25"/>

                    <line x1="0" y1="16" x2="0" y2="20"/>
                    <line x1="-12.5" y1="16" x2="-12.5" y2="20"/>
                    <line x1="-6.25" y1="16" x2="-6.25" y2="20"/>
                    <line x1="12.5" y1="16" x2="12.5" y2="20"/>
                    <line x1="6.25" y1="16" x2="6.25" y2="20"/>

                    <line x1="0" y1="-16" x2="0" y2="-20"/>
                    <line x1="-12.5" y1="-16" x2="-12.5" y2="-20"/>
                    <line x1="-6.25" y1="-16" x2="-6.25" y2="-20"/>
                    <line x1="12.5" y1="-16" x2="12.5" y2="-20"/>
                    <line x1="6.25" y1="-16" x2="6.25" y2="-20"/>
                </g>
            </g>
            <g id="db">
                <g style="fill: none; stroke-width: 3">
                    <ellipse cx="0" cy="-10" rx="25" ry="10"/>
                    <path d="M-25 -10 v 20 a 25 10 180 1 0 50 0 v -20"/>
                </g>
            </g>
            <g id="net">
                <g style="fill: none; stroke-width: 3">
                    <circle cx="0" cy="0" r="25"/>
                    <ellipse cx="0" cy="0" rx="10" ry="25"/>
                    <line x1="-25" y1="0" x2="25" y2="0"/>
                    <path d="M-17.7 17.7 L17.7 17.7"/>
                    <path d="M-17.7 -17.7 L17.7 -17.7"/>
                </g>
            </g>
            <g id="hide-thread">
                <rect style="stroke: none; fill: white" x="-40" y="-5" width="60" height="150"/>
            </g>
            <g id="hide-task">
                <rect style="stroke: none; fill: white" x="-30" y="-30" width="60" height="60"/>
            </g>
            <g id="hide-future">
                <circle cx="0" cy="0" r="15" style="stroke: none; fill: white"/>
            </g>
            <g id="hide-event-loop">
                <rect style="stroke: none; fill: white" x="-70" y="-50" width="120" height="100"/>
            </g>
            <g id="etcetera">
                <circle style="stroke: none; fill: black" cx="-10" cy="0" r="3"/>
                <circle style="stroke: none; fill: black" cx="0" cy="0" r="3"/>
                <circle style="stroke: none; fill: black" cx="10" cy="0" r="3"/>
            </g>
            <g id="equals">
                <g style="stroke: gray; stroke-width: 10">
                    <line x1="-20" y1="-10" x2="20" y2="-10"/>
                    <line x1="-20" y1="10" x2="20" y2="10"/>
                </g>
            </g>
        </defs>

        <g
            transform="translate(50, 0)"
            style="fill: none; stroke: black; stroke-width: 3"
            >
            <g class="slide-step-1">
                <use xlink:href="#clock" x="0" y="50"/>
            </g>
            <g class="slide-step-2">
                <use xlink:href="#future" x="80" y="30"/>
                <g
                    style="stroke-width: 4"
                    transform="translate(160,30)"
                    >
                    <use xlink:href="#mini-arrow-head" x="0" y="0"/>
                    <line x1="0" y1="0" x2="-50" y2="0"/>
                </g>
            </g>
            <g class="slide-step-3">
                <use xlink:href="#nothing" x="190" y="30"/>
            </g>
            <g class="slide-step-4">
                <use xlink:href="#stream" x="80" y="70"/>
                <g
                    style="stroke-width: 4"
                    transform="translate(160,70)"
                    >
                    <use xlink:href="#mini-arrow-head" x="0" y="0"/>
                    <line x1="0" y1="0" x2="-50" y2="0"/>
                </g>
            </g>
            <g class="slide-step-5">
                <use xlink:href="#timer" x="190" y="70"/>
            </g>
            <g class="slide-step-6">
                <use xlink:href="#timer" x="225" y="70"/>
                <g transform="translate(225,70),rotate(45)">
                    <line x1="0" y1="0" x2="0" y2="-8"/>
                </g>
            </g>
            <g class="slide-step-7">
                <use xlink:href="#timer" x="260" y="70"/>
                <g transform="translate(260,70),rotate(90)">
                    <line x1="0" y1="0" x2="0" y2="-8"/>
                </g>
            </g>
            <g class="slide-step-8">
                <use xlink:href="#etcetera" x="295" y="70"/>
            </g>
        </g>
    </svg>

    <ul>
        <li class="slide-step-9"><code>Deadline</code> é um <code>Future</code> que junto <code>Delay</code> com outro <code>Future</code>, para garantir
        que a operação termine antes de um determinado instante
            <ul>
                <li class="slide-step-16">Equivalente a um <em>timeout</em></li>
                <li class="slide-step-17">Poderia ser implementado como <code>future.select(Delay::new(instante))</code></li>
            </ul>
        </li>
    </ul>

    <svg style="width: 20%" viewBox="-100 0 1000 200">
        <g
            transform="translate(50, 0)"
            style="fill: none; stroke: black; stroke-width: 3"
            >
            <g class="slide-step-10">
                <use xlink:href="#future" x="0" y="25"/>
                <use xlink:href="#future" x="0" y="50"/>
                <g
                    style="stroke-width: 4"
                    transform="translate(80,25)"
                    >
                    <use xlink:href="#mini-arrow-head" x="0" y="0"/>
                    <line x1="0" y1="0" x2="-50" y2="0"/>
                </g>
                <use xlink:href="#item" x="110" y="25"/>
            </g>
            <g class="slide-step-11">
                <g
                    style="stroke-width: 4"
                    transform="translate(200,38)"
                    >
                    <use xlink:href="#mini-arrow-head" x="0" y="0"/>
                    <line x1="0" y1="0" x2="-50" y2="0"/>
                </g>
                <use xlink:href="#item" x="230" y="38"/>
            </g>

            <g class="slide-step-12">
                <use xlink:href="#equals" x="440" y="38"/>
                <use xlink:href="#future" x="520" y="38"/>
                <g
                    style="stroke-width: 4"
                    transform="translate(600,38)"
                    >
                    <use xlink:href="#mini-arrow-head" x="0" y="0"/>
                    <line x1="0" y1="0" x2="-50" y2="0"/>
                </g>
                <use xlink:href="#item" x="630" y="38"/>
            </g>
        </g>

        <g
            transform="translate(50, 100)"
            style="fill: none; stroke: black; stroke-width: 3"
            >
            <g class="slide-step-13">
                <use xlink:href="#future" x="0" y="25"/>
                <use xlink:href="#future" x="0" y="50"/>
                <g
                    style="stroke-width: 4"
                    transform="translate(80,50)"
                    >
                    <use xlink:href="#mini-arrow-head" x="0" y="0"/>
                    <line x1="0" y1="0" x2="-50" y2="0"/>
                </g>
                <use xlink:href="#nothing" x="110" y="50"/>
            </g>
            <g class="slide-step-14">
                <g
                    style="stroke-width: 4"
                    transform="translate(200,38)"
                    >
                    <use xlink:href="#mini-arrow-head" x="0" y="0"/>
                    <line x1="0" y1="0" x2="-50" y2="0"/>
                </g>
                <use xlink:href="#fail" x="230" y="38"/>
            </g>

            <g class="slide-step-15">
                <use xlink:href="#equals" x="440" y="38"/>
                <use xlink:href="#future" x="520" y="38"/>
                <g
                    style="stroke-width: 4"
                    transform="translate(600,38)"
                    >
                    <use xlink:href="#mini-arrow-head" x="0" y="0"/>
                    <line x1="0" y1="0" x2="-50" y2="0"/>
                </g>
                <use xlink:href="#fail" x="630" y="38"/>
            </g>
        </g>
    </svg>

<pre class="slide-step-18"><code>let operacao_com_timeout = operacao
	.select(Delay::new(instante))
	.and_then(|resultado| match resultado {
		Ok(Either::Left((item, _))) =&gt; Ok(item),
		Err(Either::Left((erro, _))) =&gt; Err(erro),

		Ok(Either::Right((_, _))) =&gt; Err(Erro::Timeout)
		Err(Either::Right((_, _))) =&gt; Err(Erro::Timeout),
	});

tokio::run(operacao_com_timeout)
</code></pre>
</div>
