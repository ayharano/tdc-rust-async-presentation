<div>
    <h3>Operação</h3>

<pre><code>pub trait Future {
    type Item;
    type Error;

    fn poll(&amp;mut self) -&gt; Result&lt;Async&lt;Self::Item&gt;, Self::Error&gt;;
}
</code></pre>

<pre><code>pub enum Async&lt;T&gt; {
    Ready(T),
    NotReady,
}
</code></pre>

    <ul>
        <li data-slide-steps="1-">Trait <code data-slide-steps="1-">futures::Future</code>
            <ul>
                <li data-slide-steps="2-">Representa uma operação assíncrona</li>
                <li data-slide-steps="3-">Método <code data-slide-steps="3-">poll</code> é chamado para tentar avançar a operação</li>
                <li data-slide-steps="4-">Quando terminado
                    <ul>
                        <li data-slide-steps="5-">Retorna um ítem em caso de sucesso</li>
                        <li data-slide-steps="6-">Retorna um erro em caso de falha</li>
                    </ul>
                </li>
                <li data-slide-steps="7-">Se não tiver terminado:
                <ul>
                <li data-slide-steps="8-"><strong>Precisa</strong>
                    <ul>
                        <li data-slide-steps="9-">Acessar a tarefa atual</li>
                        <li data-slide-steps="10-">Agendá-la para ser acordada quando a operação estiver pronta</li>
                        <li data-slide-steps="11-">Retorna <code>Async::NotReady</code></li>
                    </ul>
                </li>
            </ul>
        </li>
        <li data-slide-steps="12-">Na maioria dos casos não é preciso implementar um <code>Future</code> manualmente</li>
        <li data-slide-steps="13-">Mesmo se necessário, geralmente é feito compondo outros <code>Future</code>s
            <ul>
                <li data-slide-steps="14-">Basta tomar o cuidado</li>
                <li data-slide-steps="15-">Retornar <code>Async::NotReady</code> se e <strong>somente se</strong> pelo
                menos um dos <code>Future</code>s usados internamente também tiver retornado <code>Async::NotReady</code></li>
                <li data-slide-steps="16-">Ou seja, algum <code>Future</code> interno se preparou para acordar a tarefa</li>
            </ul>
        </li>
    </ul>

    <svg viewBox="0 -30 1000 300">
        <defs>
            <g id="arrow-head">
                <path d="M-20 -20 L0 0 L-20 20"></path>
            </g>
            <g id="mini-arrow-head">
                <path d="M-8 -8 L0 0 L-8 8"></path>
            </g>
            <g id="thread">
                <path d="M0 0 q 10 10 -10 20 t 0 20 0 20 0 20 0 20 0 20 0 20"></path>
            </g>
            <g id="task">
                <rect x="-25" y="-25" width="50" height="50"></rect>
            </g>
            <g id="future">
                <circle cx="0" cy="0" r="10"></circle>
            </g>
            <g id="executor">
                <rect x="-45" y="-45" width="90" height="90" rx="20" ry="20"></rect>
            </g>
            <g id="hide-task">
                <rect style="stroke: none; fill: white" x="-30" y="-30" width="60" height="60"></rect>
            </g>
            <g id="user">
                <circle cx="0" cy="-100" r="20"></circle>
                <line x1="-20" y1="0" x2="0" y2="-60"></line>
                <line x1="20" y1="0" x2="0" y2="-60"></line>
                <line x1="0" y1="-80" x2="0" y2="20"></line>
                <line x1="0" y1="20" x2="-20" y2="100"></line>
                <line x1="0" y1="20" x2="20" y2="100"></line>
            </g>
            <g id="ok">
                <path d="M-8 0 L 0 8 L 16 -8" style="stroke: green; stroke-width: 5"></path>
            </g>
            <g id="fail">
                <g style="stroke: red; stroke-width: 5">
                    <path d="M-10 -10 L 10 10"></path>
                    <path d="M10 -10 L -10 10"></path>
                </g>
            </g>
            <g id="pending">
                <circle cx="0" cy="0" r="10" style="stroke: none; fill: orange">
            </circle></g>
            <g id="hide-result">
                <rect x="-20" y="-20" width="40" height="40" style="fill: white; stroke: none"></rect>
            </g>
        </defs>

        <g transform="translate(100, 50)" style="fill: none; stroke: black; stroke-width: 3" data-slide-steps="1-">
            <use xlink:href="#future" x="220" y="65" data-slide-steps="2-"></use>
            <g data-slide-steps="3-">
                <use xlink:href="#user" style="stroke-width: 6" x="0" y="80"></use>
                <g style="stroke: gray; stroke-width: 5" transform="translate(180,50)">
                    <use xlink:href="#arrow-head" x="0" y="0"></use>
                    <line x1="0" y1="0" x2="-100" y2="0"></line>
                </g>
            </g>
            <g data-slide-steps="4-">
                <use xlink:href="#user" style="stroke-width: 6" x="0" y="80"></use>
                <g style="stroke: gray; stroke-width: 5" transform="translate(80,80),rotate(180)">
                    <use xlink:href="#arrow-head" x="0" y="0"></use>
                    <line x1="0" y1="0" x2="-100" y2="0"></line>
                </g>
            </g>
            <use xlink:href="#ok" x="50" y="80" data-slide-steps="5-"></use>
            <g data-slide-steps="6-">
                <use xlink:href="#hide-result" x="50" y="80"></use>
                <use xlink:href="#fail" x="50" y="80"></use>
            </g>
            <g data-slide-steps="7-">
                <use xlink:href="#hide-result" x="50" y="80"></use>
            </g>
            <g data-slide-steps="8-">
                <g style="stroke: black; stroke-width: 5; stroke-dasharray: 6,6" transform="translate(360,65)">
                    <use xlink:href="#arrow-head" x="0" y="0"></use>
                    <line x1="0" y1="0" x2="-100" y2="0"></line>
                </g>
            </g>
            <g data-slide-steps="9-">
                <use xlink:href="#thread" x="440" y="0"></use>
                <g style="stroke: gray; stroke-width: 5" transform="translate(560,65)">
                    <use xlink:href="#arrow-head" x="0" y="0"></use>
                    <line x1="0" y1="0" x2="-100" y2="0"></line>
                </g>
                <use xlink:href="#task" x="600" y="65"></use>
            </g>
            <g data-slide-steps="10-">
                <use xlink:href="#hide-task" x="600" y="65"></use>
                <use xlink:href="#task" style="stroke: blue" x="600" y="65"></use>
            </g>
            <g data-slide-steps="11-">
                <use xlink:href="#pending" x="50" y="80"></use>
            </g>
        </g>
    </svg>
</li></ul></div>