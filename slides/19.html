<div>
    <h1>Enviando em fluxo</h1>

<pre><code>pub trait Sink {
    type SinkItem;
	type SinkError;

	fn start_send(
		&amp;mut self, 
		item: Self::SinkItem
	) -&gt; Result&lt;(), Self::SinkError&gt;;

	fn poll_complete(&amp;mut self) -&gt; Result&lt;Async&lt;()&gt;, Self::SinkError&gt;;
}
</code></pre>

    <ul>
        <li class="slide-step-1">Representação de uma operação para enviar algo de forma assíncrona</li>
        <li class="slide-step-2">O ítem representado agora é o tipo de ítem que pode ser enviado</li>
        <li class="slide-step-3"><code>start_send</code> tenta enfileirar o envio de um ítem</li>
        <li class="slide-step-11">Mas o ítem só é enviado de fato quando <code>poll_complete</code> indicar que a operação
        de enviar todos os ítens enfileirados estiver concluída</li>
    </ul>

	<svg style="width: 20%" viewBox="0 -30 1000 300">
		<defs>
			<g id="arrow-head">
				<path d="M-20 -20 L0 0 L-20 20"/>
			</g>
			<g id="mini-arrow-head">
				<path d="M-8 -8 L0 0 L-8 8"/>
			</g>
            <g id="thread">
                <path d="M0 0 q 10 10 -10 20 t 0 20 0 20 0 20 0 20 0 20 0 20"/>
            </g>
            <g id="task">
                <rect x="-25" y="-25" width="50" height="50"/>
            </g>
            <g id="sink">
                <circle cx="0" cy="0" r="10"/>
                <g style="stroke: none; fill: black">
                    <circle cx="-9" cy="-10" r="2"/>
                    <circle cx="-15" cy="-10" r="2"/>
                    <circle cx="-21" cy="-10" r="2"/>
                </g>
            </g>
            <g id="item">
                <circle cx="0" cy="0" r="5" style="stroke: none"/>
            </g>
            <g id="hide-item">
                <circle cx="0" cy="0" r="7" style="stroke: none; fill: white"/>
            </g>
            <g id="hide-calls">
                <rect style="stroke: none; fill: white" x="-30" y="-30" width="120" height="60"/>
            </g>
            <g id="user">
                <circle cx="0" cy="-100" r="20"/>
                <line x1="-20" y1="0" x2="0" y2="-60"/>
                <line x1="20" y1="0" x2="0" y2="-60"/>
                <line x1="0" y1="-80" x2="0" y2="20"/>
                <line x1="0" y1="20" x2="-20" y2="100"/>
                <line x1="0" y1="20" x2="20" y2="100"/>
            </g>
            <g id="ok">
                <path d="M-8 0 L 0 8 L 16 -8" style="stroke: green; stroke-width: 5"/>
            </g>
            <g id="fail">
                <g style="stroke: red; stroke-width: 5">
                    <path d="M-10 -10 L 10 10"/>
                    <path d="M10 -10 L -10 10"/>
                </g>
            </g>
            <g id="pending">
                <circle cx="0" cy="0" r="10" style="stroke: none; fill: orange">
            </g>
            <g id="hide-result">
                <rect x="-20" y="-20" width="40" height="40" style="fill: white; stroke: none"/>
            </g>
		</defs>

        <g
            transform="translate(100, 50)"
            style="fill: none; stroke: black; stroke-width: 3"
            >
            <use xlink:href="#sink" class="slide-step-1" x="220" y="65"/>
            <g class="slide-step-3">
                <use xlink:href="#user" style="stroke-width: 6" x="0" y="80"/>
                <g
                    style="stroke: brown; stroke-width: 5"
                    transform="translate(180,50)"
                    >
                    <use xlink:href="#arrow-head" x="0" y="0"/>
                    <line x1="0" y1="0" x2="-100" y2="0"/>
                    <use xlink:href="#item" x="-50" y="-10" style="fill: red"/>
                </g>
            </g>
            <g class="slide-step-4">
                <use xlink:href="#item" style="fill: red" x="220" y="40"/>
                <use xlink:href="#hide-calls" x="100" y="50"/>
                <g
                    style="stroke: brown; stroke-width: 5"
                    transform="translate(80,50),rotate(180)"
                    >
                    <use xlink:href="#arrow-head" x="0" y="0"/>
                    <line x1="0" y1="0" x2="-100" y2="0"/>
                </g>
                <use xlink:href="#ok" x="60" y="50"/>
            </g>
            <g class="slide-step-5">
                <use xlink:href="#hide-result" x="60" y="50"/>
                <use xlink:href="#hide-calls" x="100" y="50"/>
                <g
                    style="stroke: brown; stroke-width: 5"
                    transform="translate(180,50)"
                    >
                    <use xlink:href="#arrow-head" x="0" y="0"/>
                    <line x1="0" y1="0" x2="-100" y2="0"/>
                    <use xlink:href="#item" x="-50" y="-10" style="fill: blue"/>
                </g>
            </g>
            <g class="slide-step-6">
                <use xlink:href="#item" style="fill: red" x="220" y="40"/>
                <use xlink:href="#item" style="fill: blue" x="220" y="30"/>
                <use xlink:href="#hide-calls" x="100" y="50"/>
                <g
                    style="stroke: brown; stroke-width: 5"
                    transform="translate(80,50),rotate(180)"
                    >
                    <use xlink:href="#arrow-head" x="0" y="0"/>
                    <line x1="0" y1="0" x2="-100" y2="0"/>
                </g>
                <use xlink:href="#ok" x="60" y="50"/>
            </g>
            <g class="slide-step-7">
                <use xlink:href="#hide-result" x="60" y="50"/>
                <use xlink:href="#hide-calls" x="100" y="50"/>
                <g
                    style="stroke: brown; stroke-width: 5"
                    transform="translate(180,50)"
                    >
                    <use xlink:href="#arrow-head" x="0" y="0"/>
                    <line x1="0" y1="0" x2="-100" y2="0"/>
                    <use xlink:href="#item" x="-50" y="-10" style="fill: green"/>
                </g>
            </g>
            <g class="slide-step-8">
                <use xlink:href="#item" style="fill: red" x="220" y="40"/>
                <use xlink:href="#item" style="fill: blue" x="220" y="30"/>
                <use xlink:href="#item" style="fill: green" x="220" y="20"/>
                <use xlink:href="#hide-calls" x="100" y="50"/>
                <g
                    style="stroke: brown; stroke-width: 5"
                    transform="translate(80,50),rotate(180)"
                    >
                    <use xlink:href="#arrow-head" x="0" y="0"/>
                    <line x1="0" y1="0" x2="-100" y2="0"/>
                </g>
                <use xlink:href="#ok" x="60" y="50"/>
            </g>
            <g class="slide-step-9">
                <use xlink:href="#hide-result" x="60" y="50"/>
                <use xlink:href="#hide-calls" x="100" y="50"/>
                <g
                    style="stroke: brown; stroke-width: 5"
                    transform="translate(180,50)"
                    >
                    <use xlink:href="#arrow-head" x="0" y="0"/>
                    <line x1="0" y1="0" x2="-100" y2="0"/>
                    <use xlink:href="#item" x="-50" y="-10" style="fill: orange"/>
                </g>
            </g>
            <g class="slide-step-10">
                <use xlink:href="#item" style="fill: red" x="220" y="40"/>
                <use xlink:href="#item" style="fill: blue" x="220" y="30"/>
                <use xlink:href="#item" style="fill: green" x="220" y="20"/>
                <use xlink:href="#hide-calls" x="100" y="50"/>
                <g
                    style="stroke: brown; stroke-width: 5"
                    transform="translate(80,50),rotate(180)"
                    >
                    <use xlink:href="#arrow-head" x="0" y="0"/>
                    <line x1="0" y1="0" x2="-100" y2="0"/>
                </g>
                <use xlink:href="#fail" x="40" y="50"/>
                <use xlink:href="#item" x="60" y="50" style="fill: orange"/>
            </g>
            <g class="slide-step-11">
                <use xlink:href="#user" style="stroke-width: 6" x="0" y="80"/>
                <use xlink:href="#hide-item" x="60" y="50"/>
                <use xlink:href="#hide-result" x="40" y="50"/>
                <use xlink:href="#hide-calls" x="100" y="50"/>
                <g
                    style="stroke: gray; stroke-width: 5"
                    transform="translate(180,50)"
                    >
                    <use xlink:href="#arrow-head" x="0" y="0"/>
                    <line x1="0" y1="0" x2="-100" y2="0"/>
                </g>
            </g>
            <g class="slide-step-12">
                <use xlink:href="#hide-item" x="220" y="20"/>
                <use xlink:href="#hide-item" x="220" y="30"/>
                <use xlink:href="#hide-item" x="220" y="40"/>
                <use xlink:href="#item" style="fill: blue" x="220" y="40"/>
                <use xlink:href="#item" style="fill: green" x="220" y="30"/>
                <use xlink:href="#hide-calls" x="100" y="50"/>
                <g
                    style="stroke: gray; stroke-width: 5"
                    transform="translate(80,50),rotate(180)"
                    >
                    <use xlink:href="#arrow-head" x="0" y="0"/>
                    <line x1="0" y1="0" x2="-100" y2="0"/>
                </g>
                <use xlink:href="#pending" x="60" y="50"/>
            </g>
            <g class="slide-step-13">
                <use xlink:href="#user" style="stroke-width: 6" x="0" y="80"/>
                <use xlink:href="#hide-result" x="60" y="50"/>
                <use xlink:href="#hide-calls" x="100" y="50"/>
                <g
                    style="stroke: gray; stroke-width: 5"
                    transform="translate(180,50)"
                    >
                    <use xlink:href="#arrow-head" x="0" y="0"/>
                    <line x1="0" y1="0" x2="-100" y2="0"/>
                </g>
            </g>
            <g class="slide-step-14">
                <use xlink:href="#hide-item" x="220" y="20"/>
                <use xlink:href="#hide-item" x="220" y="30"/>
                <use xlink:href="#hide-item" x="220" y="40"/>
                <use xlink:href="#hide-calls" x="100" y="50"/>
                <use xlink:href="#hide-result" x="60" y="50"/>
                <g
                    style="stroke: gray; stroke-width: 5"
                    transform="translate(80,50),rotate(180)"
                    >
                    <use xlink:href="#arrow-head" x="0" y="0"/>
                    <line x1="0" y1="0" x2="-100" y2="0"/>
                </g>
                <use xlink:href="#ok" x="60" y="50"/>
            </g>
        </g>
    </svg>
</div>
